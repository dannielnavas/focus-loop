<app-header />
<app-optimistic-status />
<app-notifications />
<div
  class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black p-4 sm:p-6"
>
  <div class="max-w-7xl mx-auto">
    <!-- Create Sprint Form -->
    @if (showCreateForm()) {
    <div
      class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-8 shadow-xl"
    >
      <h2 class="text-xl font-semibold text-white mb-4">Create New Sprint</h2>
      <form (ngSubmit)="createSprint()" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Title</label
            >
            <input
              type="text"
              [(ngModel)]="newSprint().name"
              name="name"
              placeholder="Sprint name"
              class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder:text-gray-400"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Status</label
            >
            <select
              [(ngModel)]="newSprint().status"
              name="status"
              class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="planned">Planned</option>
              <option value="active">Active</option>
              <option value="completed">Completed</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2"
            >Description</label
          >
          <textarea
            [(ngModel)]="newSprint().description"
            name="description"
            placeholder="Sprint description"
            rows="3"
            class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder:text-gray-400"
          ></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Start Date</label
            >
            <input
              type="date"
              [(ngModel)]="newSprint().start_date"
              name="start_date"
              class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >End Date</label
            >
            <input
              type="date"
              [(ngModel)]="newSprint().end_date"
              name="end_date"
              class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              required
            />
          </div>
        </div>

        <div class="flex justify-end space-x-3 pt-4">
          <button
            type="button"
            (click)="resetForm()"
            class="px-6 py-2 text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="px-6 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-orange-400"
          >
            Create Sprint
          </button>
        </div>
      </form>
    </div>
    }

    <!-- Sprints Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (sprint of resourcesSprints.value(); track sprint.sprint_id) {
      <div
        class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:transform hover:scale-105 cursor-pointer"
        (click)="viewSprintDetails(sprint)"
      >
        <!-- Sprint Header -->
        <div class="p-6 border-b border-gray-700">
          <div class="flex justify-between items-start mb-3">
            <h3 class="text-lg font-semibold text-white">{{sprint.name}}</h3>
            <span
              [class]="'px-3 py-1 text-xs font-medium rounded-full ' + getStatusBadgeClass(sprint.status)"
            >
              {{getStatusText(sprint.status)}}
            </span>
          </div>
          <p class="text-gray-300 text-sm mb-4">{{sprint.description}}</p>
          <div class="flex items-center text-xs text-gray-400">
            <svg
              class="w-4 h-4 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
            {{formatDate(sprint.start_date)}} - {{formatDate(sprint.end_date)}}
          </div>
        </div>

        <!-- Sprint Content -->
        <div class="p-6">
          <!-- Progress Section -->
          <div class="mb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-gray-300">Progress</span>
              <span class="text-sm text-gray-400"
                >{{getProgressPercentage(sprint)}}%</span
              >
            </div>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div
                class="h-2 rounded-full transition-all duration-300"
                [class]="getProgressBarClass(sprint.status)"
                [style.width.%]="getProgressPercentage(sprint)"
              ></div>
            </div>
          </div>

          <!-- Tasks Summary -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-300 mb-3">Sprint Tasks</h4>
            <div class="space-y-2">
              <div class="flex justify-between text-xs">
                <span class="text-gray-400">Pending</span>
                <span class="text-orange-400">{{sprint.countTaskPending}}</span>
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-gray-400">In Progress</span>
                <span class="text-blue-400"
                  >{{sprint.countTaskInProgress}}</span
                >
              </div>
              <div class="flex justify-between text-xs">
                <span class="text-gray-400">Completed</span>
                <span class="text-green-400"
                  >{{sprint.countTaskCompleted}}</span
                >
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex justify-between items-center">
            <!-- @if (sprint.status === 'active' || sprint.status === 'planned') {
            <button

              class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer font-medium"
            >
              View Details
            </button>
            } -->
            <div class="flex space-x-2">
              @if (sprint.status === 'planned') {
              <button
                (click)="updateSprintStatus(sprint, 'active')"
                class="text-xs bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-400 cursor-pointer font-medium"
              >
                Activate
              </button>
              } @if (sprint.status === 'active') {
              <button
                (click)="updateSprintStatus(sprint, 'completed')"
                class="text-xs bg-teal-600 hover:bg-teal-700 text-white px-3 py-1 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-teal-400 cursor-pointer font-medium"
              >
                Complete
              </button>
              }
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Add New Sprint Card -->
      @if (resourcesSprints.value() && resourcesSprints.value().length > 0) {
      <div
        class="bg-gray-800 rounded-xl border-2 border-dashed border-gray-600 hover:border-blue-500 transition-all duration-300 flex items-center justify-center min-h-[300px] cursor-pointer hover:bg-gray-750 group"
        (click)="showCreateForm.set(true)"
      >
        <div class="text-center">
          <div
            class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-600 transition-colors duration-300"
          >
            <svg
              class="w-8 h-8 text-gray-400 group-hover:text-white transition-colors duration-300"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              ></path>
            </svg>
          </div>
          <h3
            class="text-lg font-medium text-gray-300 group-hover:text-white transition-colors duration-300"
          >
            Add New Sprint
          </h3>
          <p class="text-sm text-gray-500 mt-2">
            Create a new sprint to organize your tasks
          </p>
        </div>
      </div>
      }
    </div>

    <!-- Empty State -->
    @if (resourcesSprints.value().length === 0) {
    <div class="text-center">
      <svg
        class="w-24 h-24 mx-auto mb-6 text-gray-600"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1"
          d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
        ></path>
      </svg>
      <h3 class="text-xl font-semibold text-gray-300 mb-2">
        No sprints created
      </h3>
      <p class="text-gray-500 mb-6">
        Start by creating your first sprint to organize your tasks
      </p>
      <button
        (click)="showCreateForm.set(true)"
        class="bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-6 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-orange-400"
      >
        Create First Sprint
      </button>
    </div>
    }
  </div>
</div>
